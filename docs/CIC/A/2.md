## Introduction[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#introduction "Direct link to Introduction")

This unit presents the initial steps to use **Core Impact** in the **Core Impact Azure demo environment**, and then will present an overview of basic pen testing features of the product through the _Rapid Penetration Testing_ modules.

## Features[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#features "Direct link to Features")

- Create workspace for a pen test session
- Scan network hosts and do service identification
- Launch remote exploits on network hosts
- Launch identity verifiers on network hosts
- Obtain local information from compromised hosts
- Escalate privileges
- Perform cleanup of deployed OS Agents
- Generate report of found vulnerabilities

## Highlighted Modules[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#highlighted-modules "Direct link to Highlighted Modules")

- Network Information Gathering RPT
- Network Attack and Penetration RPT
- Network Local Information Gathering RPT
- Network Privilege Escalation RPT
- Network Clean Up RPT
- Network Report Generation RPT
- Shell
- File Browser
- Samba Pipe dlopen Remote Code Execution Exploit
- SSH Identity Verifier
- Linux Kernel eBPF Local Privilege Escalation Exploit

## References[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#references "Direct link to References")

- Samba Pipe dlopen Remote Code Execution Exploit
    - Vulnerability: [CVE-2017-7494](https://www.samba.org/samba/security/CVE-2017-7494.html)
    - [Samba Vulnerability CVE-2017-7494](https://blog.qualys.com/vulnerabilities-research/2017/05/26/samba-vulnerability-cve-2017-7494)
- Linux Kernel eBPF Local Privilege Escalation Exploit
    - Vulnerability: [CVE-2017-16995](https://nvd.nist.gov/vuln/detail/CVE-2017-16995)
    - [eBPF Vulnerability (CVE-2017-16995): When the Doorman Becomes the Backdoor](https://blog.aquasec.com/ebpf-vulnerability-cve-2017-16995-when-the-doorman-becomes-the-backdoor)
- Weak Credentials
    - [CWE-521: Weak Password Requirements](https://cwe.mitre.org/data/definitions/521.html) (from [Mitre's Common Weakness Enumeration](https://cwe.mitre.org/)).

## Walkthrough[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#walkthrough "Direct link to Walkthrough")

### Hosts[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#hosts "Direct link to Hosts")

- Samba Pipe dlopen Remote Code Execution Exploit
    - Hostname: `ubuntu.internal.cloudapp.net`
    - IP Address: `10.27.34.67`
- Linux Kernel eBPF Local Privilege Escalation Exploit
    - Hostname: `test-virtual-machine.internal.cloudapp.net`
    - IP Address: `10.27.34.83`

### Connect to Demo Environment[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#connect-to-demo-environment "Direct link to Connect to Demo Environment")

1. From your workstation, launch **Remote Desktop Connection** and connect to the provided IP address for the _Impact Client_ VM in the demo environment.
2. When credentials are requested, select **More choices** and then **Use a different account**.
3. Enter `.\Impact` for _username_.
4. Enter the provided password for the user.
5. Click **OK**

### Install Core Impact License Bundle[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#install-core-impact-license-bundle "Direct link to Install Core Impact License Bundle")

The desktop of the _Impact Client_ VM will have the _license bundle_ package for the current user and environment.

![Impact Client VM desktop](https://impacttrial.coresecurity.com/assets/images/impact_client_vm_desktop-7d96b023f0b51a5c0be63704bc7d1627.png)

1. Double-click on the license bundle package.
2. Enter the provided passphrase and click **Decrypt**.

- This will decrypt the license bundle installer and launch it.

![License bundle ready to install](https://impacttrial.coresecurity.com/assets/images/license_bundle_ready_to_install-a9c11415252802f3dba00c3721963b3e.png)

3. Click **Install**.

- Wait for the installer to complete.

![License bundle installed](https://impacttrial.coresecurity.com/assets/images/license_bundle_installed-d7022b62502a102342ba62048bfc8306.png)

1. Click **Finish**.

- The installer will launch **Core Impact**.

### Active Core Impact[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#active-core-impact "Direct link to Active Core Impact")

**Core Impact** needs to be activated on the machine, so follow the wizard on the demo environment.

![Activation Welcome](https://impacttrial.coresecurity.com/assets/images/activation_welcome-87915dfbb98cde5bbbfe6f9b8f193e5c.png)

1. Click **Next**.

![Activation Method](https://impacttrial.coresecurity.com/assets/images/activation_method-c9fb205aec233d61c724468c34c2e306.png)

2. Click **Next**.

![Activation Machine Identification](https://impacttrial.coresecurity.com/assets/images/activation_machine_identification-6697def15a9d6f64f1cdd2b744c87097.png)

3. Click **Next**.

![Activation Internet Settings](https://impacttrial.coresecurity.com/assets/images/activation_internet_settings-cfdda55f33ec0a35ec52d48ad1fcdbb2.png)

4. Click **Next**.
    - Wait for the activation to complete.

![Activation Activating](https://impacttrial.coresecurity.com/assets/images/activation_activating-85e02a93dff86b93d25509276bc3f303.png) ![Activation Activated](https://impacttrial.coresecurity.com/assets/images/activation_activated-b3d01d519a63dd279784ec2ca1b4b1d7.png)

5. Click **Finish**.

### Create Workspace[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#create-workspace "Direct link to Create Workspace")

All pentesting tasks and results in **Core Impact** are performed in _workspaces_ that can be used to separate pen testing sessions and review results at a later time.

1. From the **Core Impact** dashboard, go to **Workspaces** on the left menu, click **Create Workspace** and click **Blank Workspace**..

![New Workspace Dashboard](https://impacttrial.coresecurity.com/assets/images/new_workspace_dashboard-3f0cd93d5b96346eebf6cc603b5326cb.png)

2. Enter a workspace name and passphrase (which must be at least 8 characters long)

![New Workspace Name &amp; Passphrase](https://impacttrial.coresecurity.com/assets/images/new_workspace_name_and_passphrase-f1b34225053be4884895b3e0c3c17202.png)

3. Click **Finish**.
    - A new and empty workspace is opened.

![New Workspace Result](https://impacttrial.coresecurity.com/assets/images/new_workspace_result-69d4c8ac8592b4baff8a83f68e6ac26f.png)

### Network Information Gathering[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#network-information-gathering "Direct link to Network Information Gathering")

1. From the **RPT Pane**, select and click **Network Information Gathering** RPT to discover hosts on the network.

![Network IG RPT Welcome](https://impacttrial.coresecurity.com/assets/images/network_ig_welcome-353904b811f84861d26dce40505fe3b3.png)

2. Click **Next**.

![Network IG RPT Discovery Method](https://impacttrial.coresecurity.com/assets/images/network_ig_discovery_method-4a0c1d417a5d1566e74a4dc51d630d03.png)

3. Click **Next**.

![Network IG RPT IP Version](https://impacttrial.coresecurity.com/assets/images/network_ig_ip_version-aaf51928f70e9ccaefa7601656845432.png)

4. Click **Next**.

![Network IG RPT IP Range Selection](https://impacttrial.coresecurity.com/assets/images/network_ig_ip_range_selection-326cb64de823f9bfe65de849e80b32a8.png)

5. Click **Next**.

**NOTE**

The network range will be initialized to the local network of the currently selected network interface of **Core Impact**'s `localagent`: `10.27.34.0/24`.

![Network IG RPT Scan Type](https://impacttrial.coresecurity.com/assets/images/network_ig_scan_type-4d8382c362e984c8e72366ec7749b3f1.png)

6. Select **Fast** and click **Finish**.
7. Wait for Network IG RPT to complete gathering information about the network.

![Network IG RPT Results](https://impacttrial.coresecurity.com/assets/images/network_ig_results-df7499485a0a7686c11c2a34007af221.png)

8. The network topology can be displayed as a chart changing the view through the Menu **View > Show entities as > Map** option.

![Network IG RPT Results](https://impacttrial.coresecurity.com/assets/images/network_ig_results_2-8970366de8e75742da4e480ba8385287.png)

### Network Attack and Penetration With Remote Exploits[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#network-attack-and-penetration-with-remote-exploits "Direct link to Network Attack and Penetration With Remote Exploits")

CAUTION

Due to a known issue recently found, before launching the Network Attack and Penetration it is needed to modify the architecture of the target Host. To do it, right click on the `ubuntu.internal.cloudapp.net` (`10.27.34.67`) > Properties > Modify the `arch` from x86-64 to i386.

1. From the **RPT Pane**, click on **Network Attack and Penetration** RPT and select `ubuntu.internal.cloudapp.net` (`10.27.34.67`) as the target host.

![Network AP RPT Welcome](https://impacttrial.coresecurity.com/assets/images/network_ap_welcome-bce14edf82203f2e86ff7b5c2505625e.png)

2. Click **Next**.

![Network AP RPT Target Selection](https://impacttrial.coresecurity.com/assets/images/network_ap_target_selection-cb1ed4b29abfbb1f56938d467c9c56b6.png)

3. Click **Next**.

![Network AP RPT Attack Method](https://impacttrial.coresecurity.com/assets/images/network_ap_attack_method-67ddee6f42cfad27414a9ee895054b5d.png)

4. Click **Next**.
    - At this point we're only going to launch remote exploits.

![Network AP RPT Attack Configuration](https://impacttrial.coresecurity.com/assets/images/network_ap_attack_configuration-9eda09483f04147c443ae6515572acd0.png)

5. Click **Next**.
    - The _Stop launching new modules on a target after an OS Agent is deployed_ is intended to reduce execution time if the goal is just to compromise a host.
    - If the goal is to be exhaustive in detecting (and trying to exploit) vulnerabilities on a host, this option should be _unchecked_.

![Network AP RPT Additional Settings](https://impacttrial.coresecurity.com/assets/images/network_ap_additional_settings-4f64b3cfa6303696f83e064bb36f7be6.png)

5. Click **Finish**.
6. Wait for **Network Attack and Penetration** RPT to complete.
    - Exploit **Samba Pipe dlopen Remote Code Execution Exploit** should have been succesful in detecting and exploiting the **CVE-2017-7494** vulnerability, and an **OS Agent** should have been deployed on the host.

![Network AP RPT Results](https://impacttrial.coresecurity.com/assets/images/network_ap_results-938d3c6154c4a22a0ebc829e6a15f5b1.png)

### Interacting With Deployed OS Agent[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#interacting-with-deployed-os-agent "Direct link to Interacting With Deployed OS Agent")

Control of a compromised host is now possible through the deployed **OS Agent**. This agent has capabilities to explore the local filesystem, launch programs and create new network connections from the host.

In order to explore the compromised host, **Core Impact** provides shells and file browsing capabilities.

1. Right-click on the **OS Agent** deployed on the `ubuntu.internal.cloudapp.net` (`10.27.34.67`) host, and select **Shell**.
2. You can execute commands to explore the filesystem and launch programs on the host.

![OS Agent Shell](https://impacttrial.coresecurity.com/assets/images/os_agent_shell-ccac62eb8657232df88ecacff6f72b1d.png)

3. Close the **Shell** window (or execute the `exit` command to close it).
4. Right-click again on the **OS Agent** and select **Browse Files**.

- The _file browser_ is launched to interactively explore the host's filesystem, which has capabilities to download/upload files from the host.

![OS Agent Shell](https://impacttrial.coresecurity.com/assets/images/os_agent_file_browser-698015cb6391c6358a01a247ba330e6f.png)

In addition to these modules, **Core Impact** has modules to retrieve _local_ information from a host were an **OS Agent** has been deployed, which you can find in the: **Information Gathering/Local** category of the **Modules** pane.

### Network Local Information Gathering[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#network-local-information-gathering "Direct link to Network Local Information Gathering")

For convenience, several _local_ modules that perform information gathering on a host can be launched through the **Network Local Information Gathering** RPT module.

1. From the **RPT Pane**, select **Network Local Information Gathering** RPT and drag & drop it on the **OS Agent** deployed on the `ubuntu.internal.cloudapp.net` (`10.27.34.67`) host.

![Network LIG RPT Welcome](https://impacttrial.coresecurity.com/assets/images/network_lig_welcome-2fa038eae415e02d677b5621e8904952.png)

2. Click **Next**.

![Network LIG RPT Agent Selection](https://impacttrial.coresecurity.com/assets/images/network_lig_agent_selection-6be878cbe3b47e8297023d84fbfb54f2.png)

3. Click **Next**.

**NOTE**
The **OS Agent** is already selected because the module has been dragged & dropped on it. Alternatively, you could have just clicked on the RPT module and in this step used the ellipsis (`...`) button to select it (or configured the module to run on all available **OS Agents**).

![Network LIG RPT Modules to run](https://impacttrial.coresecurity.com/assets/images/network_lig_modules-c1a8238b56b2e0edfe2db8babc86e7e4.png)

4. Uncheck all categories except **OS/Environment Information** to retrieve basic information about the compromised host.

**NOTE**
Other available categories can be used to launch modules to detect other issues that the host may be vulnerable to, try to extract credentials from the operating system and or browser/email programs, etc.

5. Click **Finish**.

The **Local Information Gathering** module will be executed, and several child modules can be seen after expanding it in the **Executed Modules** pane, each of which will provide _output_ and _log_ associated to the task they perform.

![Network LIG RPT Results](https://impacttrial.coresecurity.com/assets/images/network_lig_results-b6fa3dfffd38f43b8a4a8ea6edd5b0e2.png)

### Network Attack and Penetration With Identity Verifiers[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#network-attack-and-penetration-with-identity-verifiers "Direct link to Network Attack and Penetration With Identity Verifiers")

In this section we'll launch **Network Attack and Penetration** again, but instead of using it to launch exploits onto the target systems, the _identity verifiers_ functionality will be used to try and detect weak credentials by performing _dictionary attacks_ on the target systems.

If you select the `test-virtual-machine.internal.cloudapp.net` (`10.27.34.83`) host, the port & services section in the **Quick Information** pane will show that the system is running the `ssh` service, so we'll try to find weak credentials configured on that service.

1. From the **RPT Pane**, drag & drop **Network Attack and Penetration** RPT on the `test-virtual-machine.internal.cloudapp.net` (`10.27.34.83`) host.

![Network AP RPT Welcome](https://impacttrial.coresecurity.com/assets/images/network_ap_welcome-bce14edf82203f2e86ff7b5c2505625e.png)

2. Click **Next**.

![Network AP RPT Target Selection](https://impacttrial.coresecurity.com/assets/images/network_ap_target_selection_test_vm-4ef6c61614786181b7c4500a7a630d0e.png)

3. Click **Next**.

![Network AP RPT Attack Method](https://impacttrial.coresecurity.com/assets/images/network_ap_attack_method_identity_verifiers-d6b8bc2ad181ea57cf7f48eeb00feabd.png)

4. Uncheck the option to _launch exploit modules_ and select the option to _launch identity modules_.
5. Click **Next**.

![Network AP RPT Attack Configuration](https://impacttrial.coresecurity.com/assets/images/network_ap_attack_configuration_identity_verifiers-37492c0579dd4392e3c04727f6bf5405.png)

6. Click **Next**.

**NOTE**

We leave these options checked because we want to try and deploy an **OS Agent** with valid credentials that the _dictionary attack_ may find.

![Network AP RPT Additional Settings](https://impacttrial.coresecurity.com/assets/images/network_ap_additional_settings_identity_verifiers-6bb7d83c7a1e90f14006f9fe88a7c764.png)

7. Select both options in the **Identity verifiers** section:
    - Identity verifier protocol selection
    - Identity verifier attack method
8. Click **Next**.

![Network AP RPT Identity Attack Selection](https://impacttrial.coresecurity.com/assets/images/network_ap_identity_attack_selection-c799bf692eb1a361743b61727a7d3dd3.png)

9. Click the **Uncheck All** button and then check the **SSH** option.
10. Click **Next**.

![Network AP RPT Identity Attack Type](https://impacttrial.coresecurity.com/assets/images/network_ap_identity_attack_type-d9e26755de351750aba3c21456ed36de.png)

11. Click **Next**.

![Network AP RPT Identity Attack Configuration](https://impacttrial.coresecurity.com/assets/images/network_ap_identity_attack_configuration-85fbd7b85e5ca954144a8378c2d6ea83.png)

12. Select **Deep** to use an extended list of common username & passwords for the _dictionary attack_.
13. Click **Next**.

![Network AP RPT Identity Attack Options](https://impacttrial.coresecurity.com/assets/images/network_ap_identity_attack_configuration_options-18857d15f4ea2dbe2581d2f75bf1b4f2.png)

14. Click **Finish**.

The **Network Attack and Penetration** module will launch and run the **SSH Identity Verifier**. This module spawns several child tasks to perform tests in parallel based on the configuration, and rotating the tested user names to try to prevent lockout.

After a while, the module should find a valid set of credentials on the target system, and use them to deploy an **OS Agent** on the host.

![Network AP RPT Identity Attack Results](https://impacttrial.coresecurity.com/assets/images/network_ap_identity_attack_results-07e1f9ec568132fbd7ee93bb071984dd.png)

### Network Privilege Escalation[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#network-privilege-escalation "Direct link to Network Privilege Escalation")

Once again, the **OS Agent** can be leveraged to try and obtain information on the compromised host using _local_ modules, as [previously shown](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#network-local-information-gathering).

The **OS Agent** deployed through the found _identity_, however, is that of a standard/limited user on the host. We can try and see whether we can elevate privileges on the system by exploiting an unpatched _privilege escalation_ vulnerability.

1. From the **RPT Pane**, select and click **Network Privilege Escalation** RPT and drag & drop it on the **OS Agent** deployed on the `test-virtual-machine.internal.cloudapp.net` (`10.27.34.83`) host.

![Network Privilege Escalation RPT Welcome](https://impacttrial.coresecurity.com/assets/images/network_pe_welcome-4e008ea988835182736658a8a9a6255c.png)

2. Click **Next**.

![Network Privilege Escalation RPT Agent Selection](https://impacttrial.coresecurity.com/assets/images/network_pe_agent_selection-48ec51e3bceb35282692071522014c4c.png)

3. Click **Next**.

![Network Privilege Escalation RPT Exploits Selection](https://impacttrial.coresecurity.com/assets/images/network_pe_exploits_selection-2040401accd0ee137bddba27ba74c9fa.png)

4. Click **Next**.

![Network Privilege Escalation RPT Autorun](https://impacttrial.coresecurity.com/assets/images/network_pe_autorun-64b056a6c331676cae63e1ae47d1009e.png)

5. Click **Finish**.

The **Privilege Escalation** RPT module is launched, which starts launching exploits to try to detect and leverage available vulnerabilities to deploy an **OS Agent** with additional privileges.

After a while you can see that this is achieved with the **Linux Kernel eBPF Local Privilege Escalation Exploit** module.

![Network Privilege Escalation RPT Results](https://impacttrial.coresecurity.com/assets/images/network_pe_results-534873468de28ea2558409db8710b9a8.png)

### Clean Up[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#clean-up "Direct link to Clean Up")

When the pen testing session is complete, **OS Agents** deployed on the compromised hosts can be uninstalled to remove running processes and connections to those hosts through **Network Clean Up** RPT.

1. From the **RPT Pane**, select and click **Network Clean Up** RPT.

![Network Clean Up RPT Welcome](https://impacttrial.coresecurity.com/assets/images/network_cleanup_welcome-9457c59918ca22330d3724bf8620101a.png)

2. Click **Next**.

![Network Clean Up RPT Confirm](https://impacttrial.coresecurity.com/assets/images/network_cleanup_confirm-80244e2ce4290745afdfdefc64b7a0cc.png)

3. Click **Finish**.

You will see that the OS Agents deployed in the session have been uninstalled.

![Network Clean Up RPT Results](https://impacttrial.coresecurity.com/assets/images/network_cleanup_results-574b5885d7f65252f30e28d6be79f1d3.png)

### Generate report of vulnerabilities[​](https://impacttrial.coresecurity.com/docs/doc/walkthrough/basics/#generate-report-of-vulnerabilities "Direct link to Generate report of vulnerabilities")

Finally, we'll generate a **Vulnerability Report** to show the vulnerabilities identified and leveraged in the workspace.

1. From the **RPT Pane**, select and click **Network Report Generation** RPT.

![Network Report Generation RPT Welcome](https://impacttrial.coresecurity.com/assets/images/network_report_generation_welcome-1bb5661e798df85034d8e82e4f685aa3.png)

2. Click **Next**.

![Network Report Generation RPT Report Type Selection](https://impacttrial.coresecurity.com/assets/images/network_report_generation_report_type_selection-3d71a28695d1951c9cc115fab2b7aa30.png)

3. Select **Network Vulnerability Report** and click **Next**.

![Network Report Generation RPT Report Format](https://impacttrial.coresecurity.com/assets/images/network_report_generation_report_format-00f3dd668dc84a8b35d26abab57cf44a.png)

4. Click **Finish**.

The **Network Report Generation** RPT module will generate the report and open it using the program associated to open _Excel_ spreadsheets.

![Network Report Generation RPT Results](https://impacttrial.coresecurity.com/assets/images/network_report_generation_report_results-4f57d439e3c429743be4b2606b099365.png)

Though not shown here, Excel-based reports in **Core Impact** allow them to be customized after they're generated. Additionally, the user can also customize an existing Excel-based report before it's filled with the _workspace_'s results, so that these customizations can be applied every time the _duplicated_ report is generated. The user can update branding images, introductory texts, show/remove sections, and customize result tables and graphs.