Existen muchas situaciones en las que es necesario transferir archivos hacia o desde un sistema objetivo. Imaginemos el siguiente escenario:

**Estableciendo el Escenario**

Durante un engagement, obtenemos ejecución remota de código (RCE) en un servidor web IIS a través de una vulnerabilidad de carga de archivos sin restricciones. Inicialmente, subimos un web shell y luego nos enviamos un reverse shell para enumerar el sistema e intentar escalar privilegios. Intentamos usar PowerShell para transferir [PowerUp.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1) (un script de PowerShell para enumerar vectores de escalación de privilegios), pero PowerShell está bloqueado por la [Application Control Policy](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/windows-defender-application-control). Realizamos nuestra enumeración local manualmente y encontramos que tenemos [SeImpersonatePrivilege](https://docs.microsoft.com/en-us/troubleshoot/windows-server/windows-security/seimpersonateprivilege-secreateglobalprivilege). Necesitamos transferir un binario a nuestra máquina objetivo para escalar privilegios utilizando la herramienta [PrintSpoofer](https://github.com/itm4n/PrintSpoofer). Luego intentamos usar [Certutil](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil) para descargar el archivo que compilamos nosotros mismos directamente desde nuestro propio GitHub, pero la organización tiene un fuerte filtrado de contenido web en su lugar. No podemos acceder a sitios web como GitHub, Dropbox, Google Drive, etc., que pueden usarse para transferir archivos. Luego configuramos un servidor FTP e intentamos usar el cliente FTP de Windows para transferir archivos, pero el firewall de la red bloqueó el tráfico saliente para el puerto 21 (TCP). Intentamos usar la herramienta [Impacket smbserver](https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py) para crear una carpeta y descubrimos que el tráfico saliente hacia el puerto TCP 445 (SMB) estaba permitido. Utilizamos este método de transferencia de archivos para copiar con éxito el binario en nuestra máquina objetivo y lograr nuestro objetivo de escalar privilegios a un usuario de nivel administrador.

Comprender las diferentes formas de realizar transferencias de archivos y cómo operan las redes puede ayudarnos a lograr nuestros objetivos durante una evaluación. Debemos ser conscientes de los controles del host que pueden impedir nuestras acciones, como la lista blanca de aplicaciones o AV/EDR que bloquean aplicaciones o actividades específicas. Las transferencias de archivos también se ven afectadas por dispositivos de red como Firewalls, IDS o IPS que pueden monitorear o bloquear puertos particulares o operaciones no comunes.

La transferencia de archivos es una característica central de cualquier sistema operativo, y existen muchas herramientas para lograr esto. Sin embargo, muchas de estas herramientas pueden ser bloqueadas o monitoreadas por administradores diligentes, y vale la pena revisar una variedad de técnicas que pueden ser posibles en un entorno dado.

Este módulo cubre técnicas que aprovechan herramientas y aplicaciones comúnmente disponibles en sistemas Windows y Linux. La lista de técnicas no es exhaustiva. La información dentro de este módulo también puede usarse como una guía de referencia al trabajar con otros módulos de HTB Academy, ya que muchos de los ejercicios en el módulo requerirán que transfiramos archivos hacia/desde un host objetivo o hacia/desde la Pwnbox proporcionada. Se proporcionan máquinas objetivo Windows y Linux para completar algunos ejercicios prácticos como parte del módulo. Vale la pena utilizar estos objetivos para experimentar con tantas técnicas demostradas en las secciones del módulo como sea posible. Observa las diferencias entre los distintos métodos de transferencia y anota las situaciones en las que serían útiles. Una vez que hayas completado este módulo, prueba las diversas técnicas en otros módulos y cajas y laboratorios de HTB Academy en la plataforma principal de HTB.